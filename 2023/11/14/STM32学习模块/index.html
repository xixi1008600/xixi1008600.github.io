<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>STM32学习模块 | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="GPIO概述GPIO,即通用I&#x2F;O(输入&#x2F;输出)端口，是STM32可控制的引脚。STM32芯片的GPIO引脚与外部设备连接起来，可实现与外部通讯、控制外部硬件或者采集外部硬件数据的功能。 GPIO的复用：    STM32F4 有很多的内置外设，这些外设的外部引脚都是与 GPIO 共用的。也就是说，一个引脚可以有很多作用，但是默认为IO口，如果想使用一个 GPIO内置外设的功能">
<meta property="og:type" content="article">
<meta property="og:title" content="STM32学习模块">
<meta property="og:url" content="http://example.com/2023/11/14/STM32%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="GPIO概述GPIO,即通用I&#x2F;O(输入&#x2F;输出)端口，是STM32可控制的引脚。STM32芯片的GPIO引脚与外部设备连接起来，可实现与外部通讯、控制外部硬件或者采集外部硬件数据的功能。 GPIO的复用：    STM32F4 有很多的内置外设，这些外设的外部引脚都是与 GPIO 共用的。也就是说，一个引脚可以有很多作用，但是默认为IO口，如果想使用一个 GPIO内置外设的功能">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/xixi.jpg">
<meta property="article:published_time" content="2023-11-14T07:53:53.000Z">
<meta property="article:modified_time" content="2023-11-15T07:30:44.059Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/xixi.jpg"><link rel="shortcut icon" href="D:\Blog\themes\butterfly\source\img\favicon.png"><link rel="canonical" href="http://example.com/2023/11/14/STM32%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'STM32学习模块',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-15 15:30:44'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/xixi.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-folder-open"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文檔</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2023/06/08/test/"><span> 🚀 快速開始</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/img/default_top_img.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><img class="site-icon" src="/img/xixi.jpg"/><span class="site-name">Hexo</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-folder-open"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文檔</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2023/06/08/test/"><span> 🚀 快速開始</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">STM32学习模块</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-11-14T07:53:53.000Z" title="Created 2023-11-14 15:53:53">2023-11-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-11-15T07:30:44.059Z" title="Updated 2023-11-15 15:30:44">2023-11-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="STM32学习模块"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="GPIO"><a href="#GPIO" class="headerlink" title="GPIO"></a>GPIO</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>GPIO,即通用I&#x2F;O(输入&#x2F;输出)端口，是STM32可控制的引脚。STM32芯片的GPIO引脚与外部设备连接起来，可实现与外部通讯、控制外部硬件或者采集外部硬件数据的功能。</p>
<p>GPIO的复用：</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAB24_AAAfLYFwhr8831.png?token=null&ts=null" alt="img"></p>
<p>  STM32F4 有很多的内置外设，这些外设的外部引脚都是与 GPIO 共用的。也就是说，一个引脚可以有很多作用，但是默认为IO口，如果想使用一个 GPIO内置外设的功能引脚，就需要GPIO的复用。比如说串口就是GPIO复用为串口。</p>
<h2 id="GPIO的工作模式"><a href="#GPIO的工作模式" class="headerlink" title="GPIO的工作模式"></a>GPIO的工作模式</h2><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><h4 id="4种输入模式"><a href="#4种输入模式" class="headerlink" title="4种输入模式"></a>4种输入模式</h4><ul>
<li>浮空输入（即不连接内部上下拉电阻）</li>
<li>上拉输入</li>
<li>下拉输入</li>
<li>模拟输入</li>
</ul>
<h4 id="4种输出模式"><a href="#4种输出模式" class="headerlink" title="4种输出模式"></a>4种输出模式</h4><ul>
<li>开漏输出（带上拉或者下拉）</li>
<li>复用开漏输出（带上拉或者下拉）</li>
<li>推挽输出（带上拉或者下拉）</li>
<li>复用推挽输出（带上拉或者下拉）</li>
</ul>
<h4 id="4种最大输出速度"><a href="#4种最大输出速度" class="headerlink" title="4种最大输出速度"></a>4种最大输出速度</h4><ul>
<li>低速，2MHz</li>
<li>中速，25MHz</li>
<li>高速，50MHz</li>
<li>超高速，100MHz</li>
</ul>
<p><strong>速度的配置，就是决定IO口驱动电路的响应速度</strong></p>
<p>我们需要结合实际情况配置速度，不同速度会有不同的影响。</p>
<p>功耗与干扰：</p>
<ul>
<li>配置高速：输出频率高，噪音大，功耗高，电磁干扰强；</li>
<li>配置低速：输出频率低，噪音小，功耗低，电磁干扰弱；提高系统EMI（电磁干扰）性能；</li>
</ul>
<p>  实际情况中，比如：低功耗的产品，你会考虑功耗。环境不好的场合，通信不稳定，你会考虑电磁干扰（电磁干扰（Electromagnetic Interference，EMI）是干扰电缆信号并降低信号完好性的电子噪音）等。</p>
<p>速度配置实例：</p>
<p>  (1) 对于串口来说，加入最大波特率为115200bps，这样只需要用2MHz的GPIO的引脚速度就可以了，省电噪音又小；</p>
<p>  (2) 对于I2C接口，假如使用400KHz波特率，若想把余量留大一些，2MHz的GPIO引脚速度或许是不够，这时可以选用10MHz的GPIO引脚速度；</p>
<p>  (3) 对于SPI接口，假如使用18MHz或9MHz的波特率，用10MHz的GPIO口也不够用了，需要选择呢50MHz的GPIO引脚速度;</p>
<p>  (4) GPIO口设置为输入时，输出驱动电路与端口是断开的，所以这时配置输出速度是无意义的。</p>
<h3 id="详情分析"><a href="#详情分析" class="headerlink" title="详情分析"></a>详情分析</h3><h4 id="输出配置"><a href="#输出配置" class="headerlink" title="输出配置"></a>输出配置</h4><p>当某引脚配置为输出模式时，内部结构如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJidzyABg8qAAGi5YAujro513.png?token=null&ts=null" alt="img"></p>
<p>对 I&#x2F;O 端口进行编程作为输出时，内部电路关键工作如下：</p>
<ul>
<li>输出缓冲器被打开：<ul>
<li>开漏模式：输出寄存器中的“0”可激活 N-MOS，而输出寄存器中的“1”会使端口保持高阻态 (Hi-Z)（P-MOS 始终不激活）。</li>
<li>推挽模式：输出寄存器中的“0”可激活 N-MOS，而输出寄存器中的“1”可激活P-MOS。</li>
</ul>
</li>
<li>施密特触发器输入被打开。</li>
<li>根据 GPIOx_PUPDR 寄存器中的值决定是否打开弱上拉电阻和下拉电阻对输出数据寄存器的读访问可获取最后的写入值。</li>
</ul>
<p><em>说明：</em></p>
<p>高阻态（英语：High impedance）表示电路中的某个节点具有相对电路中其他点相对更高的阻抗。通俗的讲，可以看作输出（输入）电阻非常大。它的极限状态可以认为悬空（开路）。也就是说理论上高阻态不是悬空，它是对地或对电源电阻极大的状态。</p>
<p>施密特触发器（英语：Schmitt trigger）是包含正反馈的比较器电路。</p>
<ul>
<li>当输入电压高于正向阈值电压，输出为高；</li>
<li>当输入电压低于负向阈值电压，输出为低；</li>
<li>当输入在正负向阈值电压之间，输出不改变，也就是说输出由高电准位翻转为低电准位，或是由低电准位翻转为高电准位时所对应的阈值电压是不同的。只有当输入电压发生足够的变化时，输出才会变化，因此将这种元件命名为触发器。<br>施密特触发器可作为波形整形电路，能将模拟信号波形整形为数字电路能够处理的方波波形。</li>
</ul>
<p>保护二极管：引脚内部加上这两个保护二极管可以防止引脚外部过高或过低的电压输入。</p>
<p>保护二极管功能的实现原理：当引脚电压高于VDD时，上方的二极管导通吸收这个电压，当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁</p>
<p><strong>推挽电路</strong></p>
<p>  推挽电路（push-pull）就是两个不同极性晶体管间连接的输出电路。推挽电路采用两个参数相同的功率BJT管（双极结型晶体管（Bipolar Junction Transistor—BJT）常见的NPN或PNP三极管）或MOSFET管（场效应管），以推挽方式存在于电路中，各负责正负半周的波形放大任务，电路工作时，两只对称的功率开关管每次只有一个导通，所以导通损耗小效率高。推挽输出既可以向负载灌电流，也可以从负载抽取电流。</p>
<p>  在电路设计中，推挽输出是一种很常用的输出模式。推挽输出有很多优点，比如更低的损耗，更安全的输出等。推挽”之意，即为当一个管子推出去时，另一个管子拉回来。输入不同，交替导通。</p>
<p>举个例子</p>
<ul>
<li>当输入信号为高电平的时候，上面的管子导通，下面的管子截止，输出信号为高电平。</li>
<li>当输入信号为低电平的时候，上面的管子截止，下面的管子导通，输出信号为低电平。</li>
</ul>
<h4 id="输入配置"><a href="#输入配置" class="headerlink" title="输入配置"></a>输入配置</h4><p>当某引脚配置为输入模式时，内部结构如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJidzyAbnYbAAFWBuWa0TE929.png?token=null&ts=null" alt="img"></p>
<p>对 I&#x2F;O 端口进行编程作为输入模式时，内部电路关键工作如下：</p>
<ul>
<li>输出缓冲器被关闭</li>
<li>施密特触发器输入被打开</li>
<li>根据 GPIOx_PUPDR 寄存器中的值决定是否打开上拉和下拉电阻</li>
<li>输入数据寄存器每隔 1 个 AHB1 时钟周期对 I&#x2F;O 引脚上的数据进行一次采样</li>
<li>对输入数据寄存器的读访问可获取 I&#x2F;O 状态</li>
</ul>
<p><strong>施密特触发器</strong></p>
<p>  在电子学中，施密特触发器（英语：Schmitt trigger）是包含正反馈的比较器电路。</p>
<p>  对于标准施密特触发器，当输入电压高于正向阈值电压，输出为高；当输入电压低于负向阈值电压，输出为低；当输入在正负向阈值电压之间，输出不改变，也就是说输出由高电准位翻转为低电准位，或是由低电准位翻转为高电准位时所对应的阈值电压是不同的。只有当输入电压发生足够的变化时，输出才会变化，因此将这种元件命名为触发器。</p>
<p>  施密特触发器可作为波形整形电路，能将模拟信号波形整形为数字电路能够处理的方波波形，而且由于施密特触发器具有滞回特性，所以可用于抗干扰，其应用包括在开回路配置中用于抗扰，以及在闭回路正回授&#x2F;负回授配置中用于实现多谐振荡器。</p>
<h4 id="复用功能配置"><a href="#复用功能配置" class="headerlink" title="复用功能配置"></a>复用功能配置</h4><p>当某引脚配置为复用功能模式时，内部结构如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJidzyAEAnXAAFmBGwR0X0904.png?token=null&ts=null" alt="img"></p>
<p>对 I&#x2F;O 端口进行编程作为复用功能时：</p>
<ul>
<li>可将输出缓冲器配置为开漏或推挽</li>
<li>输出缓冲器由来自外设的信号驱动（发送器使能和数据）</li>
<li>施密特触发器输入被打开</li>
<li>根据 GPIOx_PUPDR 寄存器中的值决定是否打开弱上拉电阻和下拉电阻</li>
<li>输入数据寄存器每隔 1 个 AHB1 时钟周期对 I&#x2F;O 引脚上的数据进行一次采样</li>
<li>对输入数据寄存器的读访问可获取 I&#x2F;O 状态</li>
</ul>
<h4 id="模拟配置"><a href="#模拟配置" class="headerlink" title="模拟配置"></a>模拟配置</h4><p>当某引脚配置为模拟配置模式时，内部结构如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJidzyAE5hJAAEDDZ_9yvY180.png?token=null&ts=null" alt="img"></p>
<p>对 I&#x2F;O 端口进行编程作为模拟配置时：</p>
<ul>
<li>输出缓冲器被禁止。</li>
<li>施密特触发器输入停用，I&#x2F;O 引脚的每个模拟输入的功耗变为零。施密特触发器的输出被强制处理为恒定值 (0)。</li>
<li>弱上拉和下拉电阻被关闭。</li>
<li>对输入数据寄存器的读访问值为“0”。</li>
<li>在模拟配置中，I&#x2F;O 引脚不能为 5 V 容忍。</li>
</ul>
<h2 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h2><p><strong>1、LED硬件设计</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAXriBAABWrRT2zBQ493.png?token=null&ts=null" alt="img"></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJidzyAf97pAACEIQwTQko885.png?token=null&ts=null" alt="img"></p>
<p><strong>2、按键硬件设计</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAeljSAABnUEq_peI220.png?token=null&ts=null" alt="img"><br><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyACRtbAAEdtRqN-Q4918.png?token=null&ts=null" alt="img"></p>
<h2 id="寄存器编程"><a href="#寄存器编程" class="headerlink" title="寄存器编程"></a>寄存器编程</h2><p>实现步骤</p>
<ul>
<li>使能端口H硬件时钟，可以理解为启动了汽车发动机，汽车才有动力控制行走方向；</li>
<li>设置PH10引脚为输出模式，可以理解为汽车为前进模式；</li>
<li>设置PH10引脚电平状态<ul>
<li>高电平，可以理解为汽车前进</li>
<li>低电平，可以理解为汽车停止</li>
</ul>
</li>
</ul>
<h2 id="寄存器边界地址"><a href="#寄存器边界地址" class="headerlink" title="寄存器边界地址"></a>寄存器边界地址</h2><p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAYlvOAAE6yGX9iAA924.png?token=null&ts=null" alt="img"></p>
<h2 id="寄存器描述"><a href="#寄存器描述" class="headerlink" title="寄存器描述"></a>寄存器描述</h2><p><strong>1、RCC AHB1 外设时钟使能寄存器 (RCC_AHB1ENR)</strong></p>
<p><em>RCC AHB1 peripheral clock enable register</em></p>
<p>偏移地址：0x30</p>
<p>复位值：0x0010 0000</p>
<p>访问：无等待周期，按字、半字和字节访问。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAG9hqAACH2z32jgo983.png?token=null&ts=null" alt="img"></p>
<p><strong>2、GPIO 端口模式寄存器 (GPIOx_MODER) (x &#x3D; A…I)</strong></p>
<p><em>GPIO port mode register</em></p>
<p>偏移地址：0x00</p>
<p>复位值：</p>
<ul>
<li>0xA800 0000（端口 A）</li>
<li>0x0000 0280（端口 B）</li>
<li>0x0000 0000（其它端口）</li>
</ul>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAEbHZAABk-pvWaQg743.png?token=null&ts=null" alt="img"></p>
<p><strong>3、GPIO 端口输出类型寄存器 (GPIOx_OTYPER) (x &#x3D; A…I)</strong></p>
<p><em>GPIO port output type register</em></p>
<p>偏移地址：0x04</p>
<p>复位值：0x0000 0000</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAbparAABDxSWNqV4505.png?token=null&ts=null" alt="img"></p>
<p><strong>4、GPIO 端口输出速度寄存器 (GPIOx_OSPEEDR) (x &#x3D; A…I&#x2F;)</strong></p>
<p><em>GPIO port output speed register</em></p>
<p>偏移地址：0x08</p>
<p>复位值：</p>
<ul>
<li>0x0000 00C0（端口 B）</li>
<li>0x0000 0000（其它端口）</li>
</ul>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAJmTlAABeSgiTqZ8015.png?token=null&ts=null" alt="img"></p>
<p><strong>5、GPIO 端口上拉&#x2F;下拉寄存器 (GPIOx_PUPDR) (x &#x3D; A…I&#x2F;)</strong></p>
<p><em>GPIO port pull-up&#x2F;pull-down register</em></p>
<p>偏移地址：0x0C</p>
<p>复位值：</p>
<ul>
<li>0x6400 0000（端口 A）</li>
<li>0x0000 0100（端口 B）</li>
<li>0x0000 0000（其它端口）</li>
</ul>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAaUCLAABdzf3nwHM514.png?token=null&ts=null" alt="img"></p>
<p><strong>6、GPIO 端口输出数据寄存器 (GPIOx_ODR) (x &#x3D; A…I)</strong></p>
<p><em>GPIO port output data register</em></p>
<p>偏移地址：0x14</p>
<p>复位值：0x0000 0000</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAbGILAABDvWHpFrA988.png?token=null&ts=null" alt="img"></p>
<p><strong>7、GPIO 端口输入数据寄存器 (GPIOx_IDR) (x &#x3D; A…I)</strong></p>
<p><em>GPIO port input data register</em></p>
<p>偏移地址：0x10</p>
<p>复位值：0x0000 XXXX（其中 X 表示未定义）</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyASFGkAABEFdcas38744.png?token=null&ts=null" alt="img"></p>
<p><strong>8、GPIO 端口置位&#x2F;复位寄存器 (GPIOx_BSRR) (x &#x3D; A…I)</strong></p>
<p><em>GPIO port bit set&#x2F;reset register</em></p>
<p>偏移地址：0x18</p>
<p>复位值：0x0000 0000</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAfetiAAGptnq-Fbw649.png?token=null&ts=null" alt="img"></p>
<h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f4xx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_AHB1ENR	        (*(volatile uint32_t *)(0x40023800+0x30))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOH_MODER	        (*(volatile uint32_t *)(0x40020000+0x00))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOH_BSRR		    (*(volatile uint32_t *)(0x40020000+0x18))</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">led_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	RCC_AHB1ENR|=<span class="number">1</span>&lt;&lt;<span class="number">7</span>;</span><br><span class="line">	GPIOH_MODER|=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">led_off</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	GPIOH_BSRR=<span class="number">1</span>&lt;&lt;<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">led_on</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	GPIOH_BSRR=<span class="number">1</span>&lt;&lt;(<span class="number">10</span>+<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> i=<span class="number">0x200000</span>;</span><br><span class="line">	<span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	led_init();</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		led_on();</span><br><span class="line">		delay();</span><br><span class="line">	</span><br><span class="line">		led_off();</span><br><span class="line">		delay();	  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="函数接口以及使用"><a href="#函数接口以及使用" class="headerlink" title="函数接口以及使用"></a>函数接口以及使用</h2><h3 id="函数接口说明"><a href="#函数接口说明" class="headerlink" title="函数接口说明"></a>函数接口说明</h3><h4 id="端口时钟使能"><a href="#端口时钟使能" class="headerlink" title="端口时钟使能"></a>端口时钟使能</h4><p>当芯片复位后，端口硬件时钟是默认关闭状态，需要调用__HAL_RCC_GPIOx_CLK_ENABLE函数来打开，例如打开端口A、端口B、端口C硬件时钟示例代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">端口A硬件时钟使能</span><br><span class="line">__HAL_RCC_GPIOA_CLK_ENABLE()</span><br><span class="line"></span><br><span class="line">端口B硬件时钟使能</span><br><span class="line">__HAL_RCC_GPIOB_CLK_ENABLE()</span><br><span class="line"></span><br><span class="line">端口C硬件时钟使能</span><br><span class="line">__HAL_RCC_GPIOC_CLK_ENABLE()</span><br></pre></td></tr></table></figure>

<h4 id="引脚配置"><a href="#引脚配置" class="headerlink" title="引脚配置"></a>引脚配置</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_Init</span><span class="params">(GPIO_TypeDef  *GPIOx, GPIO_InitTypeDef *GPIO_Init)</span></span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li>GPIOx,指定哪个端口，x为端口号。如当前为端口A，则写GPIOA；当前为端口B，则写GPIOB。</li>
<li>GPIO_Init，GPIO的配置。</li>
</ul>
<p>返回值：无。</p>
<p>示例1：将GPIOH10配置为输出模式，引脚内部接上拉电阻。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GPIO_InitTypeDef GPIO_Initure;</span><br><span class="line"></span><br><span class="line">GPIO_Initure.Pin=GPIO_PIN_10; 		    <span class="comment">//第10根引脚</span></span><br><span class="line">GPIO_Initure.Mode=GPIO_MODE_OUTPUT_PP;	<span class="comment">//推挽输出</span></span><br><span class="line">GPIO_Initure.Pull=GPIO_PULLUP;		    <span class="comment">//上拉电阻</span></span><br><span class="line">GPIO_Initure.Speed=GPIO_SPEED_HIGH;	    <span class="comment">//高速</span></span><br><span class="line">HAL_GPIO_Init(GPIOH,&amp;GPIO_Initure);	    <span class="comment">//初始化端口H</span></span><br></pre></td></tr></table></figure>

<p>示例2：将GPIOA0配置为输入模式，引脚内部接上拉电阻。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GPIO_InitTypeDef GPIO_Initure;</span><br><span class="line"> </span><br><span class="line">GPIO_Initure.Pin=GPIO_PIN_0;              <span class="comment">//第0根引脚</span></span><br><span class="line">GPIO_Initure.Mode= GPIO_MODE_INPUT;       <span class="comment">//输入模式</span></span><br><span class="line">GPIO_Initure.Pull=GPIO_PULLUP;		      <span class="comment">//上拉电阻</span></span><br><span class="line">GPIO_Initure.Speed=GPIO_SPEED_HIGH;       <span class="comment">//高速</span></span><br><span class="line">HAL_GPIO_Init(GPIOA,&amp;GPIO_Initure);       <span class="comment">//初始化端口A</span></span><br></pre></td></tr></table></figure>

<h4 id="引脚电平输出"><a href="#引脚电平输出" class="headerlink" title="引脚电平输出"></a>引脚电平输出</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_WritePin</span><span class="params">(GPIO_TypeDef* GPIOx, <span class="type">uint16_t</span> GPIO_Pin, GPIO_PinState PinState)</span></span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li>GPIOx,指定哪个端口，x为端口号。例如当前为端口A，则写GPIOA；当前为端口B，则写GPIOB。</li>
<li>GPIO_Pin，指定哪个引脚。例如引脚为第9根引脚，则写GPIO_Pin_9。<br>PinState，引脚电平状态。高电平为GPIO_PIN_SET，低电平为GPIO_PIN_RESET。</li>
</ul>
<p>返回值：无。</p>
<p>示例1：将GPIOF9配置为输出高电平。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_GPIO_WritePin(GPIOH,GPIO_PIN_10,GPIO_PIN_SET);</span><br></pre></td></tr></table></figure>

<p>示例2：将GPIOF9配置为输出低电平。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_GPIO_WritePin(GPIOH,GPIO_PIN_10,GPIO_PIN_RESET);</span><br></pre></td></tr></table></figure>

<h4 id="引脚电平反转"><a href="#引脚电平反转" class="headerlink" title="引脚电平反转"></a>引脚电平反转</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_TogglePin</span><span class="params">(GPIO_TypeDef* GPIOx, <span class="type">uint16_t</span> GPIO_Pin)</span></span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li>GPIOx,指定哪个端口，x为端口号。例如当前为端口A，则写GPIOA；当前为端口B，则写GPIOB。</li>
<li>GPIO_Pin，指定哪个引脚。例如引脚为第9根引脚，则写GPIO_Pin_9。</li>
</ul>
<p>返回值：无。</p>
<p>示例1：将GPIOH10配置为输出电平反转。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_GPIO_TogglePin (GPIOH,GPIO_PIN_10);</span><br></pre></td></tr></table></figure>

<h4 id="读取引脚电平"><a href="#读取引脚电平" class="headerlink" title="读取引脚电平"></a>读取引脚电平</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO_PinState <span class="title function_">HAL_GPIO_ReadPin</span><span class="params">(GPIO_TypeDef* GPIOx, <span class="type">uint16_t</span> GPIO_Pin)</span></span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li>GPIOx,指定哪个端口，x为端口号。例如当前为端口A，则写GPIOA；当前为端口B，则写GPIOB。</li>
<li>GPIO_Pin，指定哪个引脚。例如引脚为第9根引脚，则写GPIO_Pin_9。</li>
</ul>
<p>返回值：引脚电平状态。</p>
<ul>
<li>高电平，GPIO_PIN_SET；</li>
<li>低电平，GPIO_PIN_RESET。</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="参考代码-1"><a href="#参考代码-1" class="headerlink" title="参考代码"></a>参考代码</h3><h5 id="gpio-c"><a href="#gpio-c" class="headerlink" title="gpio.c"></a>gpio.c</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MX_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	__HAL_RCC_GPIOH_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	HAL_GPIO_WritePin(GPIOH, GPIO_PIN_10, GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">	GPIO_InitStruct.Pin = GPIO_PIN_10;</span><br><span class="line">	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">	GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;</span><br><span class="line">	HAL_GPIO_Init(GPIOH, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_Init();</span><br><span class="line">	SystemClock_Config();</span><br><span class="line">	MX_GPIO_Init();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		HAL_GPIO_TogglePin(GPIOH, GPIO_PIN_10);</span><br><span class="line">		HAL_Delay(<span class="number">500</span>);	 </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="STM32CubeMX"><a href="#STM32CubeMX" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h2><h3 id="配置引脚为输出模式"><a href="#配置引脚为输出模式" class="headerlink" title="配置引脚为输出模式"></a>配置引脚为输出模式</h3><p>1.选中PH10引脚。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAZ4G7AAAgj-j3P68056.gif?token=null&ts=null" alt="img"></p>
<p>2.配置PH10引脚为输出模式。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAB24_AAAfLYFwhr8831.png?token=null&ts=null" alt="img"></p>
<p>3.再次详细配置PH10引脚。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAGzQ5AABLEiGV7Fs665.png?token=null&ts=null" alt="img"></p>
<p>4.导出代码。</p>
<h3 id="配置引脚为输入模式"><a href="#配置引脚为输入模式" class="headerlink" title="配置引脚为输入模式"></a>配置引脚为输入模式</h3><p>1.选中PA0引脚。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAM597AAAvtDoyfbI712.gif?token=null&ts=null" alt="img"></p>
<p>2.配置PA0为输入模式。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAB24_AAAfLYFwhr8831.png?token=null&ts=null" alt="img"></p>
<p>3.再次详细配置PA0引脚。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyABbcOAAATGRfOrt4371.png?token=null&ts=null" alt="img"></p>
<p>4.导出代码。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJidzyAb3yOAAAFZWAIeSI210.png?token=null&ts=null" alt="img"></p>
<h1 id="时钟体系"><a href="#时钟体系" class="headerlink" title="时钟体系"></a>时钟体系</h1><h2 id="时钟体系-1"><a href="#时钟体系-1" class="headerlink" title="时钟体系"></a>时钟体系</h2><h3 id="时钟数"><a href="#时钟数" class="headerlink" title="时钟数"></a>时钟数</h3><p>时钟树就是关注时钟源和时钟的流向，嵌入式系统中的模块和外设工作都以时钟为基准。</p>
<p>  STM32时钟源分为：内部时钟，外部时钟，锁相环倍频输出时钟。内部时钟和外部时钟又分为高速时钟和低速时钟。不同的时钟源，通过分频或者倍频处理后送到相应的外设单元。实际应用中根据需要配置外设的时钟控制开关，选择需要的时钟频率，并可关闭不用外设时钟。</p>
<p>  有了时钟树，就有了时钟域。嵌入式中除了内核，还有各个单元，每个单元工作在不同的时钟频率下，时钟树就是给每个单元提供不同的时钟的，STM32的时钟树详见下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAcHKRAAQ3AUUMkbk888.png?token=null&ts=null" alt="img"></p>
<p> 时钟控制器为应用带来了高度的灵活性，用户在运行内核和外设时可选择使用外部晶振或者使用振荡器，既可采用最高的频率，也可为以太网、USB OTG FS 以及 HS、I2S 和 SDIO等需要特定时钟的外设保证合适的频率。</p>
<p>  可通过多个预分频器配置 AHB 频率、高速 APB (APB2) 和低速 APB (APB1)。</p>
<p>  AHB 域的最大频率为 180 MHz，高速 APB2 域的最大允许频率为90 MHz，低速 APB1 域的最大允许频率为 45 MHz。除以下时钟外，所有外设时钟均由系统时钟 (SYSCLK) 提供：</p>
<p>1）来自于特定 PLL 输出 (PLL48CLK) 的 USB OTG FS 时钟 (48 MHz)、基于模拟技术的随机数发生器 (RNG) 时钟 (48 MHz) 和 SDIO 时钟 (48 MHz)。</p>
<p>2）I2S 时钟</p>
<p>  要实现高品质的音频性能（如码率越高，声音越保真，失真越小），可通过特定的 PLL (PLLI2S) 或映射到 I2S_CKIN 引脚的外部时钟提供 I2S 时钟。</p>
<p>3）由外部 PHY 提供的 USB OTG HS (60 MHz) 时钟</p>
<p>4）由外部 PHY 提供的以太网 MAC 时钟（TX、RX 和 RMII）。当使用以太网时，AHB时钟频率至少应为 25 MHz。</p>
<p>  RCC 向 Cortex 系统定时器 (SysTick) 馈送 8 分频的 AHB 时钟 (HCLK)。SysTick 可使用此时钟作为时钟源，也可使用 HCLK 作为时钟源，具体可在 SysTick 控制和状态寄存器中配置。</p>
<p>  STM32F405xx&#x2F;07xx 和 STM32F415xx&#x2F;17xx 的定时器时钟频率由硬件自动设置。分为两种情况：<br>如果 APB 预分频器为 1，定时器时钟频率等于 APB 域的频率。</p>
<p>  否则，等于 APB 域的频率的两倍 (×2)。</p>
<p>  STM32F42xxx 和 STM32F43xxx 的定时器时钟频率由硬件自动设置。根据 RCC_CFGR 寄存器中 TIMPRE 位的取值，共分为两种情况：</p>
<ul>
<li>如果 RCC_DKCFGR 寄存器的 TIMPRE 位清 0：</li>
</ul>
<p>  如果 APB 预分频器分频系数是 1，则定时器时钟频率 (TIMxCLK) 为 PCLKx。否则，定时器时钟频率将为 APB 域的频率的两倍：TIMxCLK &#x3D; 2 × PCLKx。</p>
<ul>
<li>如果 RCC_DKCFGR 寄存器的 TIMPRE （定时器时钟预分频器选择）位置 1：</li>
</ul>
<p>  如果 APB 预分频器配置分频系数是 1、2 或 4，则定时器时钟频率 (TIMxCLK) 将设置为HCLK。否则，定时器时钟频率将为 APB 域的频率的四倍：TIMxCLK &#x3D; 4 × PCLKx。</p>
<h3 id="时钟源"><a href="#时钟源" class="headerlink" title="时钟源"></a>时钟源</h3><h4 id="3种不同的时钟源"><a href="#3种不同的时钟源" class="headerlink" title="3种不同的时钟源"></a>3种不同的时钟源</h4><p>系统时钟 (SYSCLK)可以使用三种不同的时钟源来驱动：</p>
<ul>
<li>HSI 振荡器时钟</li>
<li>HSE 振荡器时钟</li>
<li>主 PLL时钟</li>
</ul>
<p>  在系统复位后，默认系统时钟为 HSI。在直接使用 HSI 或者通过 PLL 使用时钟源来作为系统时钟时，该时钟源无法停止。只有在目标时钟源已就绪时（时钟在启动延迟或 PLL 锁相后稳定时），才可从一个时钟源切换到另一个。如果选择尚未就绪的时钟源，则切换在该时钟源就绪时才会进行。RCC 时钟 控制寄存器 (RCC_CR) 中的状态位指示哪个（些）时钟已就绪，以及当前哪个时钟正充当系统时钟。</p>
<h5 id="HSE时钟"><a href="#HSE时钟" class="headerlink" title="HSE时钟"></a>HSE时钟</h5><p>高速外部时钟信号 (HSE) 有 2 个时钟源：</p>
<ul>
<li>HSE 外部晶振&#x2F;陶瓷谐振器</li>
<li>HSE 外部用户时钟</li>
</ul>
<p>  谐振器和负载电容必须尽可能地靠近振荡器的引脚，以尽量减小输出失真和起振稳定时间。负载电容值必须根据所选振荡器的不同做适当调整。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAbganAABUYkbLTho124.png?token=null&ts=null" alt="img"><br>HSE&#x2F;LSE 时钟源</p>
<p>HSE的特点是精度非常高。</p>
<h5 id="HSI时钟"><a href="#HSI时钟" class="headerlink" title="HSI时钟"></a>HSI时钟</h5><p> HSI 时钟信号由内部 16 MHz RC 振荡器生成，可直接用作系统时钟，或者用作 PLL 输入。HSI RC 振荡器的优点是成本较低（无需使用外部组件）。此外，其启动速度也要比 HSE 晶振快，但即使校准后，其精度也不及外部晶振或陶瓷谐振器。</p>
<p><em>校准</em></p>
<p>  因为生产工艺不同，不同芯片的 RC 振荡器频率也不同，因此 ST 会对每个器件进行出厂校 准，达到 TA&#x3D; 25 °C 时 1% 的精度。</p>
<p>  复位后，工厂校准值将加载到 RCC 时钟控制寄存器 (RCC_CR) 的 HSICAL[7:0] 位中。</p>
<p>如果应用受到电压或温度变化影响，则这可能也会影响到 RC 振荡器的速度。用户可通过 RCC 时钟控制寄存器 (RCC_CR) 中的 HSITRIM[4:0] 位对 HSI 频率进行微调。</p>
<p>  RCC 时钟控制寄存器 (RCC_CR) 中的 HSIRDY 标志指示 HSI RC 是否稳定。在启动时，硬件将此位置 1 后，HSI 才可以使用。</p>
<p>  HSI RC 可通过 RCC 时钟控制寄存器 (RCC_CR) 中的 HSION 位打开或关闭。HSI 信号还可作为备份时钟源（辅助时钟）使用，以防 HSE 晶振发生故障。</p>
<h5 id="PLL配置"><a href="#PLL配置" class="headerlink" title="PLL配置"></a>PLL配置</h5><p>STM32F4xx 器件具有两个 PLL：</p>
<ul>
<li>主 PLL (PLL) 由 HSE 或 HSI 振荡器提供时钟信号，并具有两个不同的输出时钟：<ul>
<li>第一个输出用于生成高速系统时钟（最高达 180 MHz）</li>
<li>第二个输出用于生成 USB OTG FS 的时钟 (48 MHz)、随机数发生器的时钟(48 MHz) 和 SDIO 时钟 (48 MHz)。</li>
</ul>
</li>
<li>专用 PLL (PLLI2S) 用于生成精确时钟，从而在 I2S 接口实现高品质音频性能。</li>
</ul>
<p>  由于在 PLL 使能后主 PLL 配置参数便不可更改，所以建议先对 PLL 进行配置，然后再使能 （选择 HSI 或 HSE 振荡器作为 PLL 时钟源，并配置分频系数 M、N、P 和 Q）。</p>
<p>  PLLI2S 使用与 PLL 相同的输入时钟（PLLM[5:0] 和 PLLSRC 位为两个 PLL 所共用）。但是，PLLI2S 具有专门的使能&#x2F;禁止和分频系数（N 和 R）配置位。在 PLLI2S 使能后，配置参数便不能更改。</p>
<p>  当进入停机和待机模式后，两个 PLL 将由硬件禁止；如将 HSE 或 PLL（由 HSE 提供时钟 信号）用作系统时钟，则在 HSE 发生故障时，两个 PLL 也将由硬件禁止。</p>
<h4 id="2个次级的时钟源"><a href="#2个次级的时钟源" class="headerlink" title="2个次级的时钟源"></a>2个次级的时钟源</h4><p>器件具有以下两个次级时钟源：</p>
<ul>
<li><p>32 kHz 低速内部 RC (LSI RC)，该 RC 用于驱动独立看门狗，也可选择提供给 RTC用于停机&#x2F;待机模式下的自动唤醒。</p>
</li>
<li><p>32.768 kHz 低速外部晶振（LSE 晶振），用于驱动 RTC 时钟 (RTCCLK)。<br>对于每个时钟源来说，在未使用时都可单独打开或者关闭，以降低功耗。</p>
<h5 id="LSE-时钟"><a href="#LSE-时钟" class="headerlink" title="LSE 时钟"></a>LSE 时钟</h5></li>
</ul>
<p>LSE 晶振是 32.768 kHz 低速外部 (LSE) 晶振或陶瓷谐振器，可作为实时时钟外设 (RTC) 的时钟源来提供时钟&#x2F;日历或其它定时功能，具有功耗低且精度高的优点。</p>
<p>  LSE 晶振通过 RCC 备份域控制寄存器 (RCC_BDCR) 中的 LSEON 位打开和关闭。RCC 备份域控制寄存器 (RCC_BDCR) 中的 LSERDY 标志指示 LSE 晶振是否稳定。在启动时，硬件将此位置 1 后，LSE 晶振输出时钟信号才可以使用。如在 RCC 时钟中断寄存器(RCC_CIR) 中使能中断，则可产生中断。</p>
<h5 id="LSI时钟"><a href="#LSI时钟" class="headerlink" title="LSI时钟"></a>LSI时钟</h5><p>LSI RC 可作为低功耗时钟源在停机和待机模式下保持运行，供独立看门狗 (IWDG) 和自动唤醒单元 (AWU) 使用。时钟频率在 32 kHz 左右。</p>
<p>  LSI RC 可通过 RCC 时钟控制和状态寄存器 (RCC_CSR) 中的 LSION 位打开或关闭。RCC 时钟控制和状态寄存器 (RCC_CSR) 中的 LSIRDY 标志指示低速内部振荡器是否稳定。 在启动时，硬件将此位置 1 后，此时钟才可以使用。如在 RCC 时钟中断寄存器 (RCC_CIR) 中 使能中断，则可产生中断。</p>
<h3 id="STM32CubeMX-1"><a href="#STM32CubeMX-1" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h3><h4 id="配置时钟树"><a href="#配置时钟树" class="headerlink" title="配置时钟树"></a>配置时钟树</h4><p> 如果参数配置有误，将鼠标贯标移到对应位置，会显示错误提示信息，如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAQMDPAABiPUyiFy4806.png?token=null&ts=null" alt="img"></p>
<p>正确的时钟参数配置如下图。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAXVhmAAFdHLEPDwA471.png?token=null&ts=null" alt="img"></p>
<h4 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">SystemClock_Config</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 使能电源管理时钟 */</span>	</span><br><span class="line">	__HAL_RCC_PWR_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 配置内部调节主输出电压为等级1，即最高等级。</span></span><br><span class="line"><span class="comment">	控制内部主调压器的输出电压，以便在器件未以最大频率工作时使性能与功耗实现平衡 */</span>	</span><br><span class="line">	__HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 使能PLL并配置 */</span></span><br><span class="line">	RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;</span><br><span class="line">	RCC_OscInitStruct.HSEState = RCC_HSE_ON;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLM = <span class="number">25</span>;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLN = <span class="number">360</span>;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;</span><br><span class="line">	RCC_OscInitStruct.PLL.PLLQ = <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		Error_Handler();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 激活Over-Drive模式，这种模式允许CPU和核心逻辑以更高的频率运行，可以理解为小超频，只能用于STM32F42xx/STM32F43xx/STM32F446xx/STM32F469xx/STM32F479xx*/</span></span><br><span class="line">	<span class="keyword">if</span> (HAL_PWREx_EnableOverDrive() != HAL_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		Error_Handler();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*初始化CPU、AHB和APB总线时钟，FLASH访问延迟5个时钟周期（CPU频率越高，需要等待周期越多,stm32中文参考手册，P61） */</span></span><br><span class="line">	RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK|RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;</span><br><span class="line">	RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<span class="comment">//系统时钟的时钟源为PLL</span></span><br><span class="line">	RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<span class="comment">//AHB时钟频率=系统时钟频率/1</span></span><br><span class="line">	RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<span class="comment">//APB1时钟频率=系统时钟频率/4</span></span><br><span class="line">	RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<span class="comment">//APB2时钟频率=系统时钟频率/1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		Error_Handler();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="PLL"><a href="#PLL" class="headerlink" title="PLL"></a>PLL</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>PLL(Phase Locked Loop)： 为锁相环路或锁相环，用来统一整合时钟信号，使高频器件正常工作，如内存的存取资料等。</p>
<p>  PLL基于振荡器中的反馈技术，许多电子设备要正常工作，通常需要外部的输入信号与内部的振荡信号同步。</p>
<p>  一般的晶振由于工艺与成本原因，做不到很高的频率，而在需要高频应用时，由相应的器件VCO，实现转成高频，但并不稳定，故利用锁相环路就可以实现稳定且高频的时钟信号。</p>
<h4 id="基本组成"><a href="#基本组成" class="headerlink" title="基本组成"></a>基本组成</h4><p>锁相环路是一种反馈控制电路，简称锁相环（PLL,Phase-Locked Loop）。锁相环的特点是：利用外部输入的参考信号控制环路内部振荡信号的频率和相位。因锁相环可以实现输出信号频率对输入信号频率的自动跟踪，所以锁相环通常用于闭环跟踪电路。</p>
<p>  锁相环在工作的过程中，当输出信号的频率与输入信号的频率相等时，输出电压与输入电压保持固定的相位差值，即输出电压与输入电压的相位被锁住，这就是锁相环名称的由来。锁相环通常由鉴相器（PD,Phase Detector）、环路滤波器（LF,Loop Filter）和压控振荡器（VCO,Voltage Controlled Oscillator）三部分组成。</p>
<p>  锁相环的工作原理是检测输入信号和输出信号的相位差，并将检测出的相位差信号通过鉴相器转换成电压信号输出，经低通滤波器滤波后形成压控振荡器的控制电压，对振荡器输出信号的频率实施控制，再通过反馈通路把振荡器输出信号的频率、相位反馈到鉴相器。</p>
<p>  锁相环在工作过程中，当输出信号的频率成比例地反映输入信号的频率时，输出电压与输入电压保持固定的相位差值，这样输出电压与输入电压的相位就被锁住了。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAa6YbAAIPqNqBbVU36.jpeg?token=null&ts=null" alt="img"></p>
<h4 id="类比说明"><a href="#类比说明" class="headerlink" title="类比说明"></a>类比说明</h4><p>我们刚开始学车的时候，在道路上开车，眼睛就好像一个鉴相器，负责发现车行驶的方向（反馈）和前方的路（输入）是否有差别，把差别输入大脑进行判断，然后指挥双手旋转方向盘，旋转方向盘的动作转换成车的行驶方向，如下图所示。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeACu5gAAGsDX4N1aE48.jpeg?token=null&ts=null" alt="img"></p>
<p>  我们通过这么一个闭环过程不断地调节方向盘，保证车行驶在正道上。</p>
<h4 id="PLL配置参数"><a href="#PLL配置参数" class="headerlink" title="PLL配置参数"></a>PLL配置参数</h4><p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAZcl9AADKV9EKtMU419.png?token=null&ts=null" alt="img"></p>
<p><em><strong>注：</strong></em></p>
<p>  不同的芯片，倍频（频率翻倍）公式是不一样的，需要查询芯片手册！</p>
<h3 id="时钟源切换"><a href="#时钟源切换" class="headerlink" title="时钟源切换"></a>时钟源切换</h3><p><strong>系统时钟的时钟源为PLL</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAAAUYAADocLG4o-c241.png?token=null&ts=null" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SystemClock_Config</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ..................................</span><br><span class="line">    RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLL;<span class="comment">//系统时钟的时钟源为PLL</span></span><br><span class="line">    RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;</span><br><span class="line">    RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;</span><br><span class="line">    RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;</span><br><span class="line"></span><br><span class="line">    ..................................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>系统时钟的时钟源为HSI</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAX6TLAAD_JXFdDY8467.png?token=null&ts=null" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SystemClock_Config</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ..................................</span><br><span class="line">    RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<span class="comment">//系统时钟的时钟源为HSI</span></span><br><span class="line">    RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;</span><br><span class="line">    RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;</span><br><span class="line">    RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;</span><br><span class="line"></span><br><span class="line">    ..................................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>系统时钟的时钟源为HSE</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/15/20/wKgP3GJU7LeAQ94YAADnYXOR0_Y815.png?token=null&ts=null" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SystemClock_Config</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ..................................</span><br><span class="line">    RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSE;<span class="comment">//系统时钟的时钟源为HSE</span></span><br><span class="line">    RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;</span><br><span class="line">    RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;</span><br><span class="line">    RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;</span><br><span class="line">    ..................................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="中断体系"><a href="#中断体系" class="headerlink" title="中断体系"></a>中断体系</h1><h2 id="中断的概念"><a href="#中断的概念" class="headerlink" title="中断的概念"></a>中断的概念</h2><h3 id="中断的定义"><a href="#中断的定义" class="headerlink" title="中断的定义"></a>中断的定义</h3><p>中断通常被定义为一个事件，该事件能够改变处理器执行指令的顺序。这样的事件与 CPU 芯片内外部硬件电路产生的电信号相对应（如外部引脚检测到电平跳变的事件）。</p>
<p>  中断分为同步中断和异步中断。</p>
<ul>
<li>同步中断：同步中断是当指令执行时由控制单元产生的，之所以称为同步，是因为只有在一条指令终止执行后 CPU 才会发出中断。</li>
<li>异步中断：异步中断是由其他硬件设备依照 CPU 时钟信号随机产生的。</li>
</ul>
<p>  通常我们所说的中断指的是异步中断，将同步中断称为异常。</p>
<p>  异常是由程序的错误产生的，或者是由内核必须处理的异常条件产生的。在执行指令或访问存储器时产生，因此对内核来说是“同步”的。比如说内核取址发生失败时产生的总线fault，再举个例子：系统调用(SuperVisor Call)SVC指令，当在代码中写上SVC指令，那么在执行到这个语句的时候就会触发SVC异常，进入SVC的中断服务例程。例如在FreeRTOS中，SVC（系统服务调用）用于任务启动，有些操作系统不允许应用程序直接访问硬件，也是通过提供一些系统服务函数，通过SVC来调用。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><p>中断：</p>
<ul>
<li>可屏蔽中断：I&#x2F;O设备发出的所有中断请求(lRQ)都产生可屏蔽中断。</li>
<li>不可屏蔽中断：只有几个危急事件(如硬件故障)才引起非屏蔽中断。</li>
</ul>
<p>异常：</p>
<ul>
<li>处理器异常：当CPU执行指令时探测到的一个反常条件所产生的异常（例如总线故障、取址失败等）。</li>
<li>编程异常：在编程者发出请求时发生，由特定指令触发（例如SVC系统服务调用）。</li>
</ul>
<h3 id="中断的作用"><a href="#中断的作用" class="headerlink" title="中断的作用"></a><strong>中断的作用</strong></h3><p>根据中断的定义，我们可以通过中断使处理器转而去优先运行正常控制流之外的代码。当个某个中断信号到达时，CPU 必须停止它当前正在做的事情，并且切换到一个另一个活动，从而提高硬件响应，及时处理。</p>
<p>  如何通俗的理解中断？比如我正在写代码，老板突然给我一个任务，我暂停写代码，转而把老板布置的任务完成之后，再继续写代码，这个过程就可以理解成中断。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAdaX_AAFnYjJrINg585.png?token=null&ts=null" alt="img"></p>
<p><strong>常见术语</strong></p>
<ol>
<li>中断是实现多道程序设计的必要条件。</li>
<li>中断是CPU对系统发生的某个事件作出的一种反应。</li>
<li>引起中断的事件称为中断源。</li>
<li>中断源向CPU提出处理的请求称为中断请求。</li>
<li>发生中断时被打断程序的暂停点成为断点。</li>
<li>CPU暂停现行程序而转为响应中断请求的过程称为中断响应。</li>
<li>处理中断源的程序称为中断处理程序。</li>
<li>CPU执行有关的中断处理程序称为中断处理。</li>
<li>而返回断点的过程称为中断返回。</li>
</ol>
<h3 id="中断系统的功能"><a href="#中断系统的功能" class="headerlink" title="中断系统的功能"></a>中断系统的功能</h3><p>1）实现中断响应和中断返回</p>
<p>  当CPU收到中断请求后，能根据具体情况决定是否响应中断，如果CPU没有更急、更重要的工作，则在执行完当前指令后响应这一中断请求。</p>
<p>  CPU中断响应过程如下：</p>
<ul>
<li>首先，将断点处的PC值（即下一条应执行指令的地址）推入堆栈保留下来，这称为保护断点，由硬件自动执行。</li>
<li>然后，将有关的寄存器内容和标志位状态推入堆栈保留下来，这称为保护现场，由用户自己编程完成。</li>
<li>保护断点和现场后即可执行中断服务程序。</li>
<li>执行中断服务程序完毕，CPU由中断服务程序返回主程序。</li>
</ul>
<p>  中断返回过程如下：</p>
<ul>
<li>首先恢复原保留寄存器的内容和标志位的状态，这称为恢复现场，由用户编程完成。</li>
<li>然后恢复PC值，使CPU返回断点，这称为恢复断点。</li>
<li>恢复现场和断点后，CPU将继续执行原主程序，中断响应过程到此为止。</li>
</ul>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAdhJCAAYoxcLc7R4446.gif?token=null&ts=null" alt="img"></p>
<p>2）实现优先权排队</p>
<p>  通常，系统中有多个中断源，当有多个中断源同时发出中断请求时，要求计算机能确定哪个中断更紧迫，以便首先响应。为此，计算机给每个中断源规定了优先级别，称为优先权。这样，当多个中断源同时发出中断请求时，优先权高的中断能先被响应，只有优先权高的中断处理结束后才能响应优先权低的中断。</p>
<p>  计算机按中断源优先权高低逐次响应的过程称优先权排队，这个过程可通过硬件电路来实现，亦可通过软件查询来实现。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAOsu4AAC3OSeBwcQ013.gif?token=null&ts=null" alt="img"></p>
<p>3）实现中断嵌套</p>
<p>  当CPU响应某一中断时，若有优先权高的中断源发出中断请求，则CPU能中断正在进行的中断服务程序，并保留这个程序的断点（类似于子程序嵌套），响应高级中断，高级中断处理结束以后，再继续进行被中断的中断服务程序，这个过程称为中断嵌套。如果发出新的中断请求的中断源的优先权级别与正在处理的中断源同级或更低时，CPU不会响应这个中断请求，直至正在处理的中断服务程序执行完以后才能去处理新的中断请求。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/01/rBJlJmJiuJyAKd_DAAHfC6FjpDI562.png?token=null&ts=null" alt="img"></p>
</li>
</ul>
<h3 id="应用的领域"><a href="#应用的领域" class="headerlink" title="应用的领域"></a>应用的领域</h3><p>1.触摸屏点击实时响应。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAQGalAAjoJU4_fA4058.png?token=null&ts=null" alt="img"></p>
<p>2.手机&#x2F;电脑的关机键、音量键、静音键。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAPvP6AAD0WvGiAJQ88.jpeg?token=null&ts=null" alt="img"></p>
<p>3.数据接收完成立即通知处理或无线连接状态。</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaJdGAbUdfAABRj0eejtY40.jpeg?token=null&ts=null" alt="img"></p>
<h2 id="STM32的中断"><a href="#STM32的中断" class="headerlink" title="STM32的中断"></a>STM32的中断</h2><h3 id="异常与中断"><a href="#异常与中断" class="headerlink" title="异常与中断"></a>异常与中断</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p><em>出处：《Cortex M3与M4权威指南》章节4.5 P104</em></p>
<p><strong>原文</strong></p>
<p>  Exceptions are events that cause changes to program flow. When one happens, the processor suspends the current executing task and executes a part of the program called the exception handler. After the execution of the exception handler is completed, the processor then resumes normal program execution. In the ARM architecture, interrupts are one type of exception. Interrupts are usually generated from peripheral or external inputs, and in some cases they can be triggered by software. The exception handlers for interrupts are also referred to as Interrupt Service Routines (ISR)。</p>
<p>  Each exception source has an exception number. Exception numbers 1 to 15 as system exceptions, and exceptions 16 and above are for interrupts. The design of the NVIC in the Cortex-M3 and Cortex-M4 processors can support up to 240 interrupt inputs. However, in practice the number of interrupt inputs imple mented in the design is far less, typically in the range of 16 to 100. In this way the silicon size of the design can be reduced, which also reduces power consumption。</p>
<p><strong>译文</strong></p>
<p>  异常是导致程序流更改的事件。当一个异常发生时，处理器暂停当前正在执行的任务，并执行程序中称为异常处理程序的一部分。在异常处理程序的执行完成后，处理程序就会恢复正常的程序执行。在ARM架构中，中断是异常的一种类型。中断通常由外围设备或外部输入产生，在某些情况下，中断可以由软件触发。中断的异常处理程序也被称为中断服务程序(ISR)。</p>
<p>  每个异常源都有一个异常编号。异常号1 ~ 15表示系统异常，异常号16及以上表示中断。Cortex-M3和Cortex-M4处理器中的NVIC设计可以支持多达240个中断输入。然而，在实际中，在设计中实现的中断输入的数量要少得多，通常在16到100之间。通过这种方式，设计的硅尺寸可以减少，这也降低了功耗。</p>
<p><em>出处：《Cortex M3与M4权威指南》章节4.5 P104</em></p>
<p><strong>原文</strong></p>
<p>  Nested vectored interrupt controller (NVIC，嵌套向量中断控制器)</p>
<p>  The NVIC is a part of the Cortex-M processor. It is programmable and its registers are located in the System Control Space (SCS) of the memory map.</p>
<p>  The NVIC handles the exceptions and interrupt configurations, prioritization, and interrupt masking. The NVIC has the following features:</p>
<ul>
<li>Flexible exception and interrupt management</li>
<li>Nested exception&#x2F;interrupt support</li>
<li>Vectored exception&#x2F;interrupt entry</li>
<li>Interrupt masking</li>
</ul>
<p><strong>译文</strong></p>
<p>嵌套向量中断控制器</p>
<p>  NVIC是Cortex-M处理器的一部分。它是可编程的，它的寄存器位于内存映射的系统控制空间(SCS)。</p>
<p>  NVIC处理异常和中断配置、优先级和中断屏蔽。NVIC有以下特点：</p>
<ul>
<li>灵活的异常和中断管理</li>
<li>嵌套异常&#x2F;中断支持</li>
<li>向量异常&#x2F;中断入口</li>
<li>中断屏蔽</li>
</ul>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AOGYvAAJR3nYUQAM37.jpeg?token=null&ts=null" alt="img"></p>
<h4 id="异常的类型"><a href="#异常的类型" class="headerlink" title="异常的类型"></a>异常的类型</h4><p> STM32F429在内核水平上搭载了一个异常响应系统，支持为数众多的系统异常和外部中断。</p>
<p>  其中系统异常有10个，外部中断有91个。除了个别异常的优先级被固定外，其它异常的优先级都是可编程的。</p>
<p>  有关具体的系统异常和外部中断可在 HAL 库文件 stm32f429xx.h 这个头文件查询到，在IRQn_Type这个结构体里面包含了F4系列全部的异常声明。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 中断号定义</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="comment">/******  Cortex-M4 Processor Exceptions Numbers ****************************************************************/</span></span><br><span class="line">	NonMaskableInt_IRQn         = <span class="number">-14</span>,    <span class="comment">/*!&lt; 2 Non Maskable Interrupt                                          */</span></span><br><span class="line">	MemoryManagement_IRQn       = <span class="number">-12</span>,    <span class="comment">/*!&lt; 4 Cortex-M4 Memory Management Interrupt                           */</span></span><br><span class="line">	BusFault_IRQn               = <span class="number">-11</span>,    <span class="comment">/*!&lt; 5 Cortex-M4 Bus Fault Interrupt                                   */</span></span><br><span class="line">	UsageFault_IRQn             = <span class="number">-10</span>,    <span class="comment">/*!&lt; 6 Cortex-M4 Usage Fault Interrupt                                 */</span></span><br><span class="line">	SVCall_IRQn                 = <span class="number">-5</span>,     <span class="comment">/*!&lt; 11 Cortex-M4 SV Call Interrupt                                    */</span></span><br><span class="line">	DebugMonitor_IRQn           = <span class="number">-4</span>,     <span class="comment">/*!&lt; 12 Cortex-M4 Debug Monitor Interrupt                              */</span></span><br><span class="line">	PendSV_IRQn                 = <span class="number">-2</span>,     <span class="comment">/*!&lt; 14 Cortex-M4 Pend SV Interrupt                                    */</span></span><br><span class="line">	SysTick_IRQn                = <span class="number">-1</span>,     <span class="comment">/*!&lt; 15 Cortex-M4 System Tick Interrupt                                */</span></span><br><span class="line">	<span class="comment">/******  STM32 specific Interrupt Numbers **********************************************************************/</span></span><br><span class="line">	WWDG_IRQn                   = <span class="number">0</span>,      <span class="comment">/*!&lt; Window WatchDog Interrupt                                         */</span></span><br><span class="line">	PVD_IRQn                    = <span class="number">1</span>,      <span class="comment">/*!&lt; PVD through EXTI Line detection Interrupt                         */</span></span><br><span class="line">	TAMP_STAMP_IRQn             = <span class="number">2</span>,      <span class="comment">/*!&lt; Tamper and TimeStamp interrupts through the EXTI line             */</span></span><br><span class="line">	RTC_WKUP_IRQn               = <span class="number">3</span>,      <span class="comment">/*!&lt; RTC Wakeup interrupt through the EXTI line                        */</span></span><br><span class="line">	FLASH_IRQn                  = <span class="number">4</span>,      <span class="comment">/*!&lt; FLASH global Interrupt                                            */</span></span><br><span class="line">	RCC_IRQn                    = <span class="number">5</span>,      <span class="comment">/*!&lt; RCC global Interrupt                                              */</span></span><br><span class="line">	EXTI0_IRQn                  = <span class="number">6</span>,      <span class="comment">/*!&lt; EXTI Line0 Interrupt                                              */</span></span><br><span class="line">	EXTI1_IRQn                  = <span class="number">7</span>,      <span class="comment">/*!&lt; EXTI Line1 Interrupt                                              */</span></span><br><span class="line">	EXTI2_IRQn                  = <span class="number">8</span>,      <span class="comment">/*!&lt; EXTI Line2 Interrupt                                              */</span></span><br><span class="line">	EXTI3_IRQn                  = <span class="number">9</span>,      <span class="comment">/*!&lt; EXTI Line3 Interrupt                                              */</span></span><br><span class="line">	......</span><br><span class="line">  	......  </span><br><span class="line">	SPI6_IRQn                   = <span class="number">86</span>,     <span class="comment">/*!&lt; SPI6 global Interrupt                                             */</span></span><br><span class="line">	SAI1_IRQn                   = <span class="number">87</span>,     <span class="comment">/*!&lt; SAI1 global Interrupt                                             */</span></span><br><span class="line">	LTDC_IRQn                   = <span class="number">88</span>,     <span class="comment">/*!&lt; LTDC global Interrupt                                              */</span></span><br><span class="line">	LTDC_ER_IRQn                = <span class="number">89</span>,     <span class="comment">/*!&lt; LTDC Error global Interrupt                                        */</span></span><br><span class="line">	DMA2D_IRQn                  = <span class="number">90</span>      <span class="comment">/*!&lt; DMA2D global Interrupt                                            */</span></span><br><span class="line">&#125; IRQn_Type;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>出处：《STM32F4xx中文参考手册.pdf》 P237页</em></p>
<p><strong>系统异常清单</strong></p>
<table>
<thead>
<tr>
<th align="center">编号</th>
<th align="center">优先级</th>
<th align="center">优先级类型</th>
<th align="center">名称</th>
<th align="center">说明</th>
<th align="center">地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">保留（实际存的是 MSP 地址）</td>
<td align="center">0x0000_0000</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">-3</td>
<td align="center">固定</td>
<td align="center">Reset</td>
<td align="center">复位</td>
<td align="center">0x0000_0004</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">-2</td>
<td align="center">固定</td>
<td align="center">NMI</td>
<td align="center">不可屏蔽中断。RCC 时钟安全系统(CSS) 连接到 NMI 向量</td>
<td align="center">0x0000_0008</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">-1</td>
<td align="center">固定</td>
<td align="center">HardFault</td>
<td align="center">所有类型的错误</td>
<td align="center">0x0000_000C</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">可编程</td>
<td align="center">MemManage</td>
<td align="center">内存管理错误： MPU冲突或程序从具有XN (eXecute Never)内存属性的地址位置执行。</td>
<td align="center">0x0000_0010</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">可编程</td>
<td align="center">BusFault</td>
<td align="center">总线错误：通常发生在AHB接口接收到错误响应(如果是取指令，也称为预取中止，如果是数据访问，则称为数据中止)。 也可能由其他非法访问引起。</td>
<td align="center">0x0000_0014</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">2</td>
<td align="center">可编程</td>
<td align="center">UsageFault</td>
<td align="center">使用错误：由于程序错误或试图访问协处理器的异常(Cortex-M3和Cortex-M4处理器不支持协处理器)。</td>
<td align="center">0x0000_0018</td>
</tr>
<tr>
<td align="center">7-10</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">保留</td>
<td align="center">0x0000_001C ~ 0x0000_002B</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">3</td>
<td align="center">可编程</td>
<td align="center">SVCall</td>
<td align="center">系统调用：通常用于操作系统环境，允许应用任务访问系统服务</td>
<td align="center">0x0000_002C</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">4</td>
<td align="center">可编程</td>
<td align="center">Debug Monitor</td>
<td align="center">调试监控器：当使用基于软件的调试解决方案时，触发断点、观察点等调试事件的异常</td>
<td align="center">0x0000_0030</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">保留</td>
<td align="center">0x0000_0034</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">5</td>
<td align="center">可编程</td>
<td align="center">PendSV</td>
<td align="center">可悬起系统调用：该异常通常由操作系统在进程中使用，比如上下文切换</td>
<td align="center">0x0000_0038</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">6</td>
<td align="center">可编程</td>
<td align="center">SysTick</td>
<td align="center">系统嘀嗒定时器：由处理器中包含的定时器外设产生的异常。它可以被一个操作系统使用，也可以被用作一个简单的定时器外设</td>
<td align="center">0x0000_003C</td>
</tr>
</tbody></table>
<p><strong>外部中断清单</strong></p>
<table>
<thead>
<tr>
<th align="center">编号</th>
<th align="center">优先级</th>
<th align="center">优先级类型</th>
<th align="center">名称</th>
<th align="center">说明</th>
<th align="center">地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">16</td>
<td align="center">7</td>
<td align="center">可编程</td>
<td align="center">WWDG</td>
<td align="center">窗口看门狗中断</td>
<td align="center">0x0000_0040</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">8</td>
<td align="center">可编程</td>
<td align="center">PVD</td>
<td align="center">连接 EXTI 线的可编程电压检测中断</td>
<td align="center">0x0000_0044</td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">9</td>
<td align="center">可编程</td>
<td align="center">TAMP_STAMP</td>
<td align="center">连接 EXTI 线的入侵和时间戳中断</td>
<td align="center">0x0000_0048</td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">10</td>
<td align="center">可编程</td>
<td align="center">RTC_WKUP</td>
<td align="center">连接到 EXTI 线的 RTC 唤醒中断</td>
<td align="center">0x0000_004C</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody></table>
<h3 id="NVIC"><a href="#NVIC" class="headerlink" title="NVIC"></a>NVIC</h3><p> NVIC是嵌套向量中断控制器，控制着整个芯片中断相关的功能，它跟内核紧密耦合，是内核里面的一个外设。但是各个芯片厂商在设计芯片的时候会对Cortex-M4 内核里面的 NVIC 进行裁剪，把不需要的部分去掉，所以说 STM32 的 NVIC 是 Cortex-M4 的 NVIC 的一个子集。</p>
<h4 id="NVIC寄存器简介"><a href="#NVIC寄存器简介" class="headerlink" title="NVIC寄存器简介"></a>NVIC寄存器简介</h4><p>​	NVIC 的结构体定义给每个寄存器在core_m4.h头文件中，实际上STM32F429 只使用部分，具体使用了多少可参考《Cortex®-M4 内核编程手册》-4.2:NVIC 寄存器映射。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  __IOM <span class="type">uint32_t</span> ISER[<span class="number">8U</span>];               <span class="comment">/* 中断使能寄存器 */</span></span><br><span class="line">        <span class="type">uint32_t</span> RESERVED0[<span class="number">24U</span>];</span><br><span class="line">  __IOM <span class="type">uint32_t</span> ICER[<span class="number">8U</span>];               <span class="comment">/* 中断清除寄存器 */</span></span><br><span class="line">        <span class="type">uint32_t</span> RSERVED1[<span class="number">24U</span>];</span><br><span class="line">  __IOM <span class="type">uint32_t</span> ISPR[<span class="number">8U</span>];               <span class="comment">/* 中断使能悬起寄存器 */</span></span><br><span class="line">        <span class="type">uint32_t</span> RESERVED2[<span class="number">24U</span>];</span><br><span class="line">  __IOM <span class="type">uint32_t</span> ICPR[<span class="number">8U</span>];               <span class="comment">/* 中断清除悬起寄存器 */</span></span><br><span class="line">        <span class="type">uint32_t</span> RESERVED3[<span class="number">24U</span>];</span><br><span class="line">  __IOM <span class="type">uint32_t</span> IABR[<span class="number">8U</span>];               <span class="comment">/* 中断有效位寄存器 */</span></span><br><span class="line">        <span class="type">uint32_t</span> RESERVED4[<span class="number">56U</span>];</span><br><span class="line">  __IOM <span class="type">uint8_t</span>  IP[<span class="number">240U</span>];               <span class="comment">/* 中断优先级寄存器(8Bit wide) */</span></span><br><span class="line">        <span class="type">uint32_t</span> RESERVED5[<span class="number">644U</span>];</span><br><span class="line">  __OM  <span class="type">uint32_t</span> STIR;                   <span class="comment">/* 软件触发中断寄存器 */</span></span><br><span class="line">&#125;  NVIC_Type;</span><br></pre></td></tr></table></figure>

<p>在配置中断的时候我们一般只用 ISER、ICER 和 IP 这三个寄存器，ISER 用来使能中断，ICER 用来失能中断，IP 用来设置中断优先级。</p>
<h4 id="NVIC中断配置固件库"><a href="#NVIC中断配置固件库" class="headerlink" title="NVIC中断配置固件库"></a>NVIC中断配置固件库</h4><p>在固件库文件 core_cm4.h 的最后，还提供了 NVIC 的一些函数，这些函数遵循 CMSIS（ARM Cortex™ 微控制器软件接口标准：Cortex Microcontroller Software Interface Standard） 规则，只要是 Cortex-M4 的处理器都可以使用，具体如下：</p>
<p><strong>符合CMSIS 标准的 NVIC 库函数</strong></p>
<table>
<thead>
<tr>
<th align="left">NVIC 库函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">void NVIC_EnableIRQ(IRQn_Type IRQn)</td>
<td>使能中断</td>
</tr>
<tr>
<td align="left">void NVIC_DisableIRQ(IRQn_Type IRQn)</td>
<td>禁止中断</td>
</tr>
<tr>
<td align="left">void NVIC_SetPendingIRQ(IRQn_Type IRQn)</td>
<td>设置中断悬起位</td>
</tr>
<tr>
<td align="left">void NVIC_ClearPendingIRQ(IRQn_Type IRQn)</td>
<td>清除中断悬起位</td>
</tr>
<tr>
<td align="left">uint32_t NVIC_GetPendingIRQ(IRQn_Type IRQn)</td>
<td>获取悬起中断编号</td>
</tr>
<tr>
<td align="left">void NVIC_SetPriority(IRQn_Type IRQn, uint32_t priority)</td>
<td>设置中断优先级</td>
</tr>
<tr>
<td align="left">uint32_t NVIC_GetPriority(IRQn_Type IRQn)</td>
<td>获取中断优先级</td>
</tr>
<tr>
<td align="left">void NVIC_SystemReset(void)</td>
<td>系统复位</td>
</tr>
</tbody></table>
<p>  这些库函数在编程的时候用的都比较少，甚至基本都不用。在配置中断的时候会有更加简洁的方法。</p>
<h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><h5 id="优先级定义"><a href="#优先级定义" class="headerlink" title="优先级定义"></a>优先级定义</h5><p>在 NVIC 有一个专门的寄存器：中断优先级寄存器 NVIC_IPRx（在 F429 中，x&#x3D;0…90）用来配置外部中断的优先级，IPR 宽度为 8bit，原则上每个外部中断可配置的优先级为0~255，数值越小，优先级越高。但是绝大多数 CM4 芯片都会精简设计，以致实际上支持的优先级数减少，在 F429 中，只使用了高 4bit，如下所示：</p>
<p><strong>F429 使用 4bit 表达优先级</strong></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-ATRxhAABBG0tsW10210.png?token=null&ts=null" alt="img"></p>
<p>  用于表达优先级的这 4bit，又被分组成抢占优先级和子优先级。如果有多个中断同时响应，抢占优先级高的就会剥夺抢占优先级低的优先得到执行，如果抢占优先级相同，就比较子优先级。如果抢占优先级和子优先级都相同的话，就比较他们的硬件中断编号，编号越小，优先级越高。</p>
<p><strong>抢占优先级与子优先级区别</strong></p>
<ol>
<li>高抢占优先级是可以打断正在进行的低抢占优先级的中断。抢占优先级若相同，则不会出现抢占的过程。</li>
</ol>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AMaAfAACYvLXSxrA044.png?token=null&ts=null" alt="img"></p>
<ol>
<li>抢占优先级相同的中断，高子优先级不可以打断低子优先级中断的执行。</li>
</ol>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AKDM-AAC3aJqj1pI019.png?token=null&ts=null" alt="img"></p>
<ol>
<li>抢占优先级相同的中断，当两个中断同时发生请求的情况下，哪个子优先级高，哪个先响应。</li>
</ol>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AEtJ2AACWxQMTzkk620.png?token=null&ts=null" alt="img"></p>
<ol>
<li>抢占优先级相同且子优先级相同的中断，假如同时发生，会按照硬件内部固定的优先级执行，如下图。</li>
</ol>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AQrHkAAMo1-NCi3s820.png?token=null&ts=null" alt="img"></p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AHuDBAAC6jDe3Xb4953.png?token=null&ts=null" alt="img"></p>
<h5 id="优先级分组"><a href="#优先级分组" class="headerlink" title="优先级分组"></a>优先级分组</h5><p>优先级的分组由内核外设 SCB 的应用程序中断及复位控制寄存器 AIRCR 的PRIGROUP[10:8]位决定，F429 分为了 5 组，具体如下：</p>
<p><img src="http://edu.yueqian.com.cn/group1/M00/00/00/rBJlJmJaPK-AHMHCAADbceh1CSU925.png?token=null&ts=null" alt="img"></p>
<p>  设置优先级分组可调用HAL库函数HAL_NVIC_SetPriorityGrouping()实现，有关 NVIC 中断相关的库函数都在库文件 core_m4.h 中,中断优先级分组库函数如下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 配置中断优先级分组：抢占优先级和子优先级</span></span><br><span class="line"><span class="comment">  *  </span></span><br><span class="line"><span class="comment">  * 参数如下：</span></span><br><span class="line"><span class="comment">  * @arg NVIC_PRIORITYGROUP_0: 0 bits for 抢占优先级</span></span><br><span class="line"><span class="comment">  *                            4 bits for 子优先级</span></span><br><span class="line"><span class="comment">  * @arg NVIC_PRIORITYGROUP_1: 1 bits for 抢占优先级</span></span><br><span class="line"><span class="comment">  *                            3 bits for 子优先级</span></span><br><span class="line"><span class="comment">  * @arg NVIC_PRIORITYGROUP_2: 2 bits for 抢占优先级</span></span><br><span class="line"><span class="comment">  *                            2 bits for 子优先级</span></span><br><span class="line"><span class="comment">  * @arg NVIC_PRIORITYGROUP_3: 3 bits for 抢占优先级</span></span><br><span class="line"><span class="comment">  *                            1 bits for 子优先级</span></span><br><span class="line"><span class="comment">  * @arg NVIC_PRIORITYGROUP_4: 4 bits for 抢占优先级</span></span><br><span class="line"><span class="comment">  *                            0 bits for 子优先级</span></span><br><span class="line"><span class="comment">  * @注意：如果优先级分组为 0，则抢占优先级就不存在，优先级就全部由子优先级控制</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_NVIC_SetPriorityGrouping</span><span class="params">(<span class="type">uint32_t</span> PriorityGroup)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* 检查参数 */</span></span><br><span class="line">  assert_param(IS_NVIC_PRIORITY_GROUP(PriorityGroup));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 设置优先级分组*/</span></span><br><span class="line">  NVIC_SetPriorityGrouping(PriorityGroup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2023/11/14/STM32%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/">http://example.com/2023/11/14/STM32%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/xixi.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/11/14/%E2%80%9C%E8%81%8A%E5%A4%A9%E5%AE%A4%EF%BC%88TCP%EF%BC%89%E2%80%9D/" title="“聊天室（TCP）”"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">“聊天室（TCP）”</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/xixi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description">手握日月摘心陈</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.4399.com/"><i class="iconfont icon-youxishoubing"></i><span>摸🦑</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><b><font color="#e66b6d">双</font> <font color="#e66d98">手</font> <font color="#e66cc6">合</font> <font color="#cc6de6">十</font> <font color="#9770e6">成</font> <font color="#6d93e6">为</font> <font color="#6fcde6">自</font> <font color="#72e6b6">己</font> <font color="#72e689">的</font> <font color="#99e670">神</font>, <font color="#cde670">自</font> <font color="#e6df72">己</font> <font color="#e6c073">所</font> <font color="#e6a271">信</font> <font color="#e6796f">念</font> <font color="#e65454">的</font> <font color="#e63333">即</font> <font color="#e62c2c">是</font> <font color="#e60101">信</font> <font color="#e60101">仰</font></b> <p align="center"><img src="https://haiyong.site/img/img-blog.csdnimg.cn/f7384c88956d4378b72e47548e19c9f8.gif" width="50" alt="mao"></p> <p align="center">微信号：deximua</p> <p align="center">QQ号：2655675221</p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GPIO"><span class="toc-number">1.</span> <span class="toc-text">GPIO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPIO%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">GPIO的工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">简述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E7%A7%8D%E8%BE%93%E5%85%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">4种输入模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E7%A7%8D%E8%BE%93%E5%87%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">4种输出模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E7%A7%8D%E6%9C%80%E5%A4%A7%E8%BE%93%E5%87%BA%E9%80%9F%E5%BA%A6"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">4种最大输出速度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E6%83%85%E5%88%86%E6%9E%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">详情分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">输出配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">输入配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">复用功能配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">模拟配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">1.3.</span> <span class="toc-text">原理图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E7%BC%96%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">寄存器编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E8%BE%B9%E7%95%8C%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.</span> <span class="toc-text">寄存器边界地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.6.</span> <span class="toc-text">寄存器描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E4%BB%A3%E7%A0%81"><span class="toc-number">1.6.1.</span> <span class="toc-text">参考代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.</span> <span class="toc-text">函数接口以及使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.1.</span> <span class="toc-text">函数接口说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%97%B6%E9%92%9F%E4%BD%BF%E8%83%BD"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">端口时钟使能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">引脚配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E7%94%B5%E5%B9%B3%E8%BE%93%E5%87%BA"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">引脚电平输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E7%94%B5%E5%B9%B3%E5%8F%8D%E8%BD%AC"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">引脚电平反转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%BC%95%E8%84%9A%E7%94%B5%E5%B9%B3"><span class="toc-number">1.7.1.5.</span> <span class="toc-text">读取引脚电平</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">参考代码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#gpio-c"><span class="toc-number">1.8.1.0.1.</span> <span class="toc-text">gpio.c</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#main-c"><span class="toc-number">1.8.1.0.2.</span> <span class="toc-text">main.c</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STM32CubeMX"><span class="toc-number">1.9.</span> <span class="toc-text">STM32CubeMX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%BC%95%E8%84%9A%E4%B8%BA%E8%BE%93%E5%87%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.1.</span> <span class="toc-text">配置引脚为输出模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%BC%95%E8%84%9A%E4%B8%BA%E8%BE%93%E5%85%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.2.</span> <span class="toc-text">配置引脚为输入模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB"><span class="toc-number">2.</span> <span class="toc-text">时钟体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB-1"><span class="toc-number">2.1.</span> <span class="toc-text">时钟体系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">时钟数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E6%BA%90"><span class="toc-number">2.1.2.</span> <span class="toc-text">时钟源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E6%97%B6%E9%92%9F%E6%BA%90"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">3种不同的时钟源</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HSE%E6%97%B6%E9%92%9F"><span class="toc-number">2.1.2.1.1.</span> <span class="toc-text">HSE时钟</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HSI%E6%97%B6%E9%92%9F"><span class="toc-number">2.1.2.1.2.</span> <span class="toc-text">HSI时钟</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PLL%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.2.1.3.</span> <span class="toc-text">PLL配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E4%B8%AA%E6%AC%A1%E7%BA%A7%E7%9A%84%E6%97%B6%E9%92%9F%E6%BA%90"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">2个次级的时钟源</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LSE-%E6%97%B6%E9%92%9F"><span class="toc-number">2.1.2.2.1.</span> <span class="toc-text">LSE 时钟</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LSI%E6%97%B6%E9%92%9F"><span class="toc-number">2.1.2.2.2.</span> <span class="toc-text">LSI时钟</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#STM32CubeMX-1"><span class="toc-number">2.1.3.</span> <span class="toc-text">STM32CubeMX</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%B6%E9%92%9F%E6%A0%91"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">配置时钟树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">实例代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PLL"><span class="toc-number">2.1.4.</span> <span class="toc-text">PLL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">基本组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E6%AF%94%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">类比说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PLL%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">PLL配置参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E6%BA%90%E5%88%87%E6%8D%A2"><span class="toc-number">2.1.5.</span> <span class="toc-text">时钟源切换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E4%BD%93%E7%B3%BB"><span class="toc-number">3.</span> <span class="toc-text">中断体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">中断的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">中断的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">3.1.2.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">中断的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">3.1.4.</span> <span class="toc-text">中断系统的功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%9A%84%E9%A2%86%E5%9F%9F"><span class="toc-number">3.1.5.</span> <span class="toc-text">应用的领域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STM32%E7%9A%84%E4%B8%AD%E6%96%AD"><span class="toc-number">3.2.</span> <span class="toc-text">STM32的中断</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E4%B8%8E%E4%B8%AD%E6%96%AD"><span class="toc-number">3.2.1.</span> <span class="toc-text">异常与中断</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">异常的类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVIC"><span class="toc-number">3.2.2.</span> <span class="toc-text">NVIC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NVIC%E5%AF%84%E5%AD%98%E5%99%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">NVIC寄存器简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVIC%E4%B8%AD%E6%96%AD%E9%85%8D%E7%BD%AE%E5%9B%BA%E4%BB%B6%E5%BA%93"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">NVIC中断配置固件库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.2.3.1.</span> <span class="toc-text">优先级定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E5%88%86%E7%BB%84"><span class="toc-number">3.2.2.3.2.</span> <span class="toc-text">优先级分组</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/14/STM32%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/" title="STM32学习模块">STM32学习模块</a><time datetime="2023-11-14T07:53:53.000Z" title="Created 2023-11-14 15:53:53">2023-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/14/%E2%80%9C%E8%81%8A%E5%A4%A9%E5%AE%A4%EF%BC%88TCP%EF%BC%89%E2%80%9D/" title="“聊天室（TCP）”">“聊天室（TCP）”</a><time datetime="2023-11-14T03:36:01.000Z" title="Created 2023-11-14 11:36:01">2023-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/10/QT%E7%AC%AC%E4%B8%80%E8%AF%BE/" title="xixitest">xixitest</a><time datetime="2023-11-10T03:27:03.000Z" title="Created 2023-11-10 11:27:03">2023-11-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/09/hello-world/" title="Hello World">Hello World</a><time datetime="2023-11-09T13:12:07.788Z" title="Created 2023-11-09 21:12:07">2023-11-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/default_top_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By John Doe</div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="Toggle Between Light And Dark Mode"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="/moyu/"><i class="fa fa-gamepad"></i><span>休闲游戏</span></a><a class="rightMenu-item" target="_blank" rel="noopener" href="https://tools.haiyong.site"><i class="fa fa-tools"></i><span>实用工具</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:changeMouseMode();"><i class="fa fa-mouse"></i><span>切换鼠标右键</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="/js/sun_moon.js" async></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>